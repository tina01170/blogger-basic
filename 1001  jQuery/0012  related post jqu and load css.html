<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <style>
    /* related-posts */

    #related-posts { overflow:hidden; margin:60px 0; position:relative; width:100%; }
    #related-posts .loader { height:185px; }
    .loader:after{content:'';position:absolute;top:50%;left:50%;width:26px;height:26px;margin:-16px 0 0 -16px;border:3px solid #ddd;border-right-color:$(main.color);border-radius:100%;animation:spinner .8s infinite linear;transform-origin:center}
    @-webkit-keyframes spinner {
    0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}
    to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}
    }
    @keyframes spinner {
    0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}
    to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}
    }

    #related-posts{ overflow:hidden; margin:60px 0; position:relative; width:100%; }
    #related-posts h2 { font-size:24px; line-height:34px; color:$(title.color); margin:0 0 40px; padding:0; border-bottom:1px solid #E0E0E0; font-family:'Roboto',sans-serif; }
    #related-posts h2:after { content:''; display:block; width:140px; height:2px; margin-top:8px; background-color:$(main.color); }

    #related-posts #related-content{ width:100%; }
    #related-content ul { position:relative; overflow:hidden; list-style:none;display:flex;flex-wrap:wrap;  margin:0 -10px; box-sizing:border-box; }
    .related-item { width:33.3%; padding:0 10px; position:relative;overflow:hidden; box-sizing:border-box; }
    .related-item .post-image-link { display:block; position:relative; overflow:hidden; width:100%; height:150px; margin: 0 0 10px; }

    .related-posts h3 { font-size:18px; font-weight:700; line-height:1.7em;  margin:5px 0; }
    .related-posts h3 a { display: block; color:$(title.color); font-family:'Roboto',sans-serif; -webkit-transition: color 0.3s; -moz-transition: color 0.3s; transition:color .3s; }
    .related-item h3 a:hover { color:$(main.color);}
    .related-item .post-date { font-size:16px; color:#000; }
    @media screen and (max-width: 992px) {  
      .related-item { width:50%; margin:0 0 30px;}
      .related-item h3 { margin:10px 0 0; }
      .related-item h3 a { font-size:18px; }
      .related-item .post-image-link {  height:180px; }
    }
    @media screen and (max-width: 768px) { 
      .related-item {  width:100%; margin:0 0 55px;}
      .related-item .post-image-link {  height:440px;  }
    }
    @media screen and (max-width: 600px) { 
      .related-item {  width:100%; margin:0 0 55px;}
      .related-item .post-image-link {  height:360px;  }
    }
    @media screen and (max-width: 480px) {
      .related-item .post-image-link { height:300px; }
    }
    @media screen and (max-width: 420px) {
      .related-item .post-image-link { height:200px; }
    }

    </style>
  </head>
  <body>
      <b:includable id='postRelated' var='post'><!--不一樣的地方-->
        <div id='related-posts'>
            <h2><data:messages.youMayLikeThesePosts/></h2>
            <div id='related-content'>
              <b:if cond='data:post.labels'>
                 <div class='related-tag' expr:data-label='data:post.labels.first.name'/>
              <b:else/>
                  <div class='related-tag' data-label='recent'/>
              </b:if>
            </div>   
        </div>
      </b:includable>
    
    <script>
        $('.banner .HTML .widget-content, .sidebar .HTML .widget-content, #footer .HTML .widget-content').each(function() {
          var t = $(this);  
          var e = (t.text().trim().toLowerCase())
          var	a =	e.split('/');  console.log(" e =" + e );
          var count = a[0], label=a[1], type=a[2];
          return Posts(t, e, count, label);
        })
        $('#related-content').each(function() {
          var $this = $(this);  //console.log($this); 
          label = $this.find('.related-tag').data('label');
          Posts($this, 'related', 3, label); 
        })
    </script> 
    <script>
      function Posts($this, type, count, label) {
          //console.log($this, type, count, label);
            if ( type.match('megatabs') || type.match('hot') || type.match('list') ||type.match('related')) {
            var url = '';
              if (label == 'recent') {
                  url = '/feeds/posts/default?alt=json-in-script&max-results=' + count;
                } else {
                  url = '/feeds/posts/default/-/' + label + '?alt=json-in-script&max-results=' + count;
                }
                $.ajax({
                        url: url,
                        type: 'get',
                        dataType: 'jsonp',
                beforeSend:function() {
                  if (type.match('hot')) {
                    $this.html('<div class="loader"/>').parent().addClass('show-hot');
                            } else if (type.match('list')) {
                                $this.html('<div class="loader"/>').parent().addClass('show-list');
                            } else if (type.match('related')) {
                                $this.html('<div class="loader"/>').parent().addClass('show-related');
                            }
                },
                        success: function(json) {
                  if (type.match('megatabs')) {
                                var code = '<ul id="tab-widget">';
                  } else if (type.match('hot')) {
                                var code = '<ul class="hot-posts">';
                  } else if (type.match('list')) {
                    var code = '<ul class="custom-widget">';
                            } else if (type.match('related')) {
                                var code = '<ul class="related-posts">';
                            }
                  var entry = json.feed.entry;
                            if (entry != undefined) {
                    for (var i = 0,feed = entry;i < entry.length; i++) {
                      var link = l(feed,i);
                                    var title = t(feed,i);
                                    var date = e(feed, i);
                                    var	image = g(feed,i,title);
                      var tag = p(feed, i);
                      var content = '';
                      if (type.match('list')) {                           
                        content += '<li class="recent-item">' + image + '<div class="post-info"><h3><a href="' + link + '">' + title +'</a></h3>'+ date +'</div></li>';
                                    } else if (type.match('related')) {
                                        content += '<li class="related-item">' + image + '<div class="post-info"><h3><a href="' + link + '">' + title + '</a></h3>'+ date +'</div></li>';
                                    } else if (type.match('hot')) {
                                        content += '<li class="hot-item"><div class="hot-item-inner">' + image + '<div class="post-info">'+ tag +'<h3 class="hot-title"><a href="' + link + '">' + title + '</a></h3>'+ date +'</div></div></li>';
                                    } else if (type.match('megatabs')) {	 
                        content += '<li class="tab-item"><div class="mega-content">' + image + '<div class="post-info"><h4><a href="' + link + '">' + title + date +'</a></h4></div></div></li>';
                                    }                                                
                                    code += content;                           
                    }
                                code += '</ul>';     	
                            } else {
                                code = '<ul class="no-posts">No Posts Found</ul>';
                            }
                            $this.html(code);
                }
                });
            }
        }
    </script>
   
  </body>
</html>